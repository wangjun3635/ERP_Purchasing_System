<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.team.purchasing.mapper.order.OrderDao">

    <resultMap id="baseMap" type="com.team.purchasing.bean.order.Order">
       <result property="id" column="id" />
       <result property="userId" column="userId" />
       <result property="HCId" column="HCId" />
       <result property="orderNumber" column="orderNumber" />
       <result property="totalAmount" column="totalAmount" />
       <result property="orderStatus" column="orderStatus" />
       <result property="orderRemark" column="orderRemark" />
       <result property="deliveryNumber" column="deliveryNumber" />
       <result property="receiverName" column="receiverName" />
       <result property="receiverPhone" column="receiverPhone" />
       <result property="receiverPostCode" column="receiverPostCode" />
       <result property="receiverProvince" column="receiverProvince" />
       <result property="receiverCity" column="receiverCity" />
       <result property="receiverRegion" column="receiverRegion" />
       <result property="createTime" column="createTime" />
       <result property="createUserId" column="createUserId" />
       <result property="updateTime" column="updateTime" />
       <result property="updateUserId" column="updateUserId" />
    </resultMap>

    <select id="queryOrderCount">
        select count(*) from
        (select row_number() over(order by updateTime desc) as rownumber, * from
        ( select * from tb_order <include refid="baseQuery" /> ) as oo  )
        as o where rownumber > #{order.page.rowNumber}
    </select>

    <select id="queryOrderList" resultMap="baseMap">
        select id,
     userId,
     HCId,
     orderNumber,
     totalAmount,
     orderStatus,
     orderRemark,
     deliveryNumber,
     receiverName,
     receiverPhone,
     receiverPostCode,
     receiverProvince,
     receiverCity,
     receiverRegion,
     createTime,
     createUserId,
     updateTime,
     updateUserId

     from
     (select row_number() over(order by updateTime desc) as rownumber, * from
     ( select * from tb_order <include refid="baseQuery" /> ) as oo  )
     as o where rownumber > #{order.page.rowNumber}
    </select>

    <sql id="baseQuery">
      where 1=1
      <if test="order.orderStatus != null">
        and orderStatus=#{order.orderStatus}
      </if>
      <if test="order.orderNumber != null">
        and orderNumber=#{order.orderNumber}
      </if>
      <if test="order.createTime != null">
        and createTime=to_date(#{order.createTime}, 'YYYY-MM-DD')
      </if>
    </sql>

</mapper>